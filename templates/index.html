<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MessageGPT</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Lexend:wght@300..900&display=swap');

:root{
--bg:#171717;--header:#2c2c2c;--box:#2a2a2a;
--text:#fff;--accent:#6c63ff;
}
.light{
--bg:linear-gradient(135deg,#ffecd2,#fcb69f);
--header:linear-gradient(90deg,#667eea,#764ba2);
--box:#fff;--text:#222;--accent:#ff6a00;
}
*{box-sizing:border-box;transition:.3s}
body{margin:0;background:var(--bg);font-family:Lexend;color:var(--text)}

header{
background:var(--header);
padding:14px;
font-size:1.8em;
font-weight:900;
display:flex;
justify-content:space-between;
align-items:center;
}

.chatArea{
height:calc(100vh - 140px);
overflow-y:auto;
padding:12px;
}

.myMsg,.aiMsg{display:flex;margin:8px}
.myMsg{justify-content:flex-end}
.aiMsg{justify-content:flex-start}

.myBox,.aiBox{
max-width:65%;
padding:14px;
border-radius:16px;
background:var(--box);
}

.controls{
position:fixed;
bottom:12px;
width:100%;
display:flex;
justify-content:center;
}
.inputWrap{
width:80%;
position:relative;
}
textarea{
width:100%;
height:60px;
border-radius:18px;
padding:14px 50px 14px 14px;
border:none;
resize:none;outline:none;
font-family:Lexend;
}

.sendBtn{
position:absolute;
right:10px;
top:50%;
transform:translateY(-50%);
background:none;
border:none;
cursor:pointer;
}
.sendBtn svg{fill:var(--accent);width:22px}

.menu{
position:fixed;
right:-320px;
top:0;
width:320px;
height:100%;
background:var(--box);
padding:14px;
}
.menu.open{right:0}

.menuItem{
padding:10px;
border-bottom:1px solid #444;
cursor:pointer;
}

.aiOrb{
width:14px;height:14px;
border-radius:50%;
background:var(--accent);
animation:pulse 1.2s infinite;
}
@keyframes pulse{
0%{transform:scale(.7);opacity:.4}
50%{transform:scale(1.2);opacity:1}
100%{transform:scale(.7);opacity:.4}
}
  button{border:none;background:transparent}
  button:hover{height:10px}
</style>
</head>

<body>

<header>
MessageGPT
<div>
<button onclick="toggleTheme()">ðŸŒ—</button>
<button onclick="toggleMenu()">â˜°</button>
</div>
</header>

<div class="chatArea" id="chatA"></div>

<div class="controls">
<div class="inputWrap">
<textarea id="userInput" placeholder="Ask anything..."></textarea>
<button class="sendBtn" onclick="sendMessage()">
<svg viewBox="0 0 24 24"><path d="M2 21l21-9L2 3v7l15 2-15 2z"/></svg>
</button>
</div>
</div>

<div class="menu" id="menu">
  <button id="menuCloseBtn" style="background:grey;border:none;cursor:pointer;">
<svg width="22" height="22" viewBox="0 0 24 24" fill="white">
<path d="M18.3 5.71 12 12l6.3 6.29-1.42 1.42L12 13.41l-6.29 6.3-1.42-1.42L10.59 12 4.29 5.71 5.7 4.29 12 10.59l6.29-6.3z"/>
</svg>
</button>

<hr>
<p><b>About</b><br>Creator: Aditya<br>Uses Gemini API</p>
  <hr></div>
  

<script>
/* ---------- FIREBASE ---------- */
const firebaseConfig = {
      apiKey: "AIzaSyBHenryTkUVP21VqW7KL44ZXM_P_Qq6IIc",
      authDomain: "chatting-e3bb2.firebaseapp.com",
      databaseURL: "https://chatting-e3bb2-default-rtdb.firebaseio.com/",
      projectId: "chatting-e3bb2",
      storageBucket: "chatting-e3bb2.appspot.com",
      messagingSenderId: "913896104186",
      appId: "1:913896104186:web:7a6c81f80268d46f772943",
      measurementId: "G-W9YHTX6SQR"
    };
    firebase.initializeApp(firebaseConfig);

const db = firebase.database();

/* ---------- UI ---------- */
const chatA=document.getElementById("chatA");
const historyTab=document.getElementById("historyTab");
const menu = document.getElementById("menu");
const menuBtn = document.querySelector("header button:last-child");
const closeBtn = document.getElementById("menuCloseBtn");

/* OPEN / CLOSE TOGGLE */
function toggleMenu() {
    menu.classList.toggle("open");
}

/* CLOSE BUTTON */
closeBtn.onclick = () => {
    menu.classList.remove("open");
};

/* CLICK OUTSIDE TO CLOSE */
document.addEventListener("click", (e) => {
    if (
        menu.classList.contains("open") &&
        !menu.contains(e.target) &&
        !menuBtn.contains(e.target)
    ) {
        menu.classList.remove("open");
    }
});
function toggleTheme(){document.body.classList.toggle("light")}
function toggleMenu(){document.getElementById("menu").classList.toggle("open")}

/* ---------- UTILS ---------- */
function encodeKey(t){
return btoa(t).replace(/[/+=]/g,"");
}

function formatAI(t){
return t.replace(/\*\*(.*?)\*\*/g,"<b>$1</b>");
}

/* ---------- HISTORY ---------- */
function saveLocal(q,a){
let h=JSON.parse(localStorage.getItem("history")||"[]");
h.unshift({q,a});
localStorage.setItem("history",JSON.stringify(h));
loadHistory();
}

function loadHistory(){
historyTab.innerHTML="";
(JSON.parse(localStorage.getItem("history")||"[]")).forEach(x=>{
let d=document.createElement("div");
d.className="menuItem";
d.textContent=x.q;
d.onclick=()=>addAI(x.a);
historyTab.appendChild(d);
});
}
loadHistory();

/* ---------- CHAT ---------- */
function addAI(t){
let ai=document.createElement("div");
ai.className="aiMsg";
let box=document.createElement("div");
box.className="aiBox";
box.innerHTML=formatAI(t);
ai.appendChild(box);
chatA.appendChild(ai);
chatA.scrollTop=chatA.scrollHeight;
}

function sendMessage(){
const input=document.getElementById("userInput");
const msg=input.value.trim();
if(!msg)return;

let my=document.createElement("div");
my.className="myMsg";
my.innerHTML=`<div class="myBox"></div>`;
my.firstChild.textContent=msg;
chatA.appendChild(my);
input.value="";

let loader=document.createElement("div");
loader.className="aiMsg";
loader.innerHTML=`<div class="aiBox"><div class="aiOrb"></div></div>`;
chatA.appendChild(loader);

const key=encodeKey(msg);

/* CHECK FIREBASE */
db.ref("mess/"+key).once("value").then(snap=>{
if(snap.exists()){
loader.remove();
addAI(snap.val().answer);
}else{
fetch("/chat",{method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({message:msg})})
.then(r=>r.json())
.then(d=>{
loader.remove();
addAI(d.reply);
saveLocal(msg,d.reply);

/* SAVE TO FIREBASE */
db.ref("mess/"+key).set({
question:msg,
answer:d.reply
});
});
}
});
}
</script>

</body>
</html>
