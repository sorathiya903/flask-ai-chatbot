<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MessageGPT</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Lexend:wght@300..900&display=swap');

:root{
--bg:#171717;--header:#2c2c2c;--box:#2a2a2a;
--text:#fff;--accent:#6c63ff;
}
.light{
--bg:linear-gradient(135deg,#ffecd2,#fcb69f);
--header:linear-gradient(90deg,#667eea,#764ba2);
--box:#fff;--text:#222;--accent:#ff6a00;
}
  
#flip {
  height:25px;
  opacity:0.7;
  padding-left:5px;
  overflow:hidden;
}

#flip > div > div {
  color:#fff;
  background: linear-gradient(90deg, #6c63ff, #00f0ff, #ff6a00, #ff1a75);
  background-size: 300% 300%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: gradientMove 2.5s ease-in-out infinite;
  height:45px;
  margin-bottom:45px;
  display:inline-block;
}
@keyframes gradientMove {
  0%   { background-position: 0% 50%; }
  50%  { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
#flip div:first-child {
  animation: show 2s ease infinite;
}



@keyframes show {
  0% {margin-top:-270px;}
  5% {margin-top:-180px;}
  33% {margin-top:-180px;}
  38% {margin-top:-90px;}
  66% {margin-top:-90px;}
  71% {margin-top:0px;}
  99.99% {margin-top:0px;}
  100% {margin-top:-270px;}
}

*{box-sizing:border-box;transition:.3s}
body{margin:0;background:var(--bg);font-family:Lexend;color:var(--text)}

header{
background:var(--header);
padding:14px;
font-size:1.8em;
font-weight:900;
display:flex;
justify-content:space-between;
align-items:center;
}

.chatArea{
height:calc(100vh - 140px);
overflow-y:auto;
padding:12px;
}

.myMsg,.aiMsg{display:flex;margin:8px}
.myMsg{justify-content:flex-end}
.aiMsg{justify-content:flex-start}

.myBox,.aiBox{
max-width:65%;
padding:14px;
border-radius:16px;
background:var(--box);
}

.controls{
position:fixed;
bottom:12px;
width:100%;
display:flex;
justify-content:center;
}
.inputWrap{
width:80%;
position:relative;
}
textarea{
width:100%;
height:60px;
border-radius:18px;
padding:14px 50px 14px 14px;
border:none;
resize:none;outline:none;
font-family:Lexend;
}

.sendBtn{
position:absolute;
right:10px;
top:50%;
transform:translateY(-50%);
background:none;
border:none;
cursor:pointer;
}
.sendBtn svg{fill:var(--accent);width:22px}

.menu{
position:fixed;
right:-320px;
top:0;
width:320px;
height:100%;
background:var(--box);
padding:14px;
}
.menu.open{right:0}

.menuItem{
padding:10px;
border-bottom:1px solid #444;
cursor:pointer;
}

.aiOrb{
width:14px;height:14px;
border-radius:50%;
background:var(--accent);
animation:pulse 1.2s infinite;
}
@keyframes pulse{
0%{transform:scale(.7);opacity:.4}
50%{transform:scale(1.2);opacity:1}
100%{transform:scale(.7);opacity:.4}
}
  button{border:none;background:transparent}
  button:hover{height:10px}
 .head{
  
  font-weight: 900;
  text-align: center;

  background: linear-gradient(
    to right,
    #00FFFF 0%,
  /* Neon Cyan */
    #00BFFF 20%,  /* Deep Sky Blue */
    #1E90FF 40%,  /* Dodger Blue */
    #007FFF 60%,  /* Electric Blue */
    #005FFF 80%,  /* Vivid Medium Blue */
   
#00ffff 100%   /* Deep Electric Blue */
  );
  background-size: 300% auto;

  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;

  animation: shine 5s linear infinite;
}

@keyframes shine {
  0% { background-position: 0% center; }
  50% { background-position: 200% center; }
  100% { background-position: 0% center; }
}
</style>
</head>

<body>

<header>
  <div class="head">MessageGPT</div>
<div>
<button onclick="toggleTheme()">ðŸŒ—</button>
<button onclick="toggleMenu()">â˜°</button>
</div>
</header>
 
<div class="chatArea" id="chatA"></div>

<div class="controls">
<div class="inputWrap">
<textarea id="userInput" placeholder="Ask anything..."></textarea>
<button class="sendBtn" onclick="sendMessage()">
<svg viewBox="0 0 24 24"><path d="M2 21l21-9L2 3v7l15 2-15 2z"/></svg>
</button>
</div>
</div>

<div class="menu" id="menu">
  <button id="menuCloseBtn" onclick="toggleMenu()" style="background:grey;border:none;cursor:pointer;">
<svg width="22" height="22" viewBox="0 0 24 24" fill="white">
<path d="M18.3 5.71 12 12l6.3 6.29-1.42 1.42L12 13.41l-6.29 6.3-1.42-1.42L10.59 12 4.29 5.71 5.7 4.29 12 10.59l6.29-6.3z"/>
</svg>
</button>

<hr>
<p><b>About</b><br>Creator: Aditya<br>Uses Gemini API</p>
  <hr></div>
  

<script>
/* ---------- FIREBASE ---------- */
const firebaseConfig = {
      apiKey: "AIzaSyBHenryTkUVP21VqW7KL44ZXM_P_Qq6IIc",
      authDomain: "chatting-e3bb2.firebaseapp.com",
      databaseURL: "https://chatting-e3bb2-default-rtdb.firebaseio.com/",
      projectId: "chatting-e3bb2",
      storageBucket: "chatting-e3bb2.appspot.com",
      messagingSenderId: "913896104186",
      appId: "1:913896104186:web:7a6c81f80268d46f772943",
      measurementId: "G-W9YHTX6SQR"
    };
    firebase.initializeApp(firebaseConfig);

const db = firebase.database();

/* ---------- FIREBASE INIT ---------- */
function toggleTheme(){
 document.body.classList.toggle("light") 
}
/* ---------- ESCAPE HTML FUNCTION ---------- */
function escapeHTML(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}
function toggleMenu(){
  document.getElementById('menu').classList.toggle("open")
}
/* ---------- CREATE AI MESSAGE WITH CODE & BOLD ---------- */
function createAIMessageWithCopy(text) {
    const box = document.createElement("div");
    box.className = "aiBox";

    const regex = /```([\s\S]*?)```/g;
    let last = 0, match;

    while ((match = regex.exec(text))) {
        // Text before code block
        const before = text.slice(last, match.index);
        if (before.trim()) {
            const p = document.createElement("div");
            p.innerHTML = escapeHTML(before).replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
            box.appendChild(p);
        }

        // Code block
        const pre = document.createElement("div");
        pre.className = "code-block";

        const code = document.createElement("code");
        code.textContent = match[1].trim();

        const btn = document.createElement("button");
        btn.className = "copy-btn";
        btn.textContent = "Copy";
        btn.onclick = () => {
            navigator.clipboard.writeText(code.textContent);
            btn.textContent = "Copied!";
            setTimeout(()=>btn.textContent="Copy",1200);
        };

        pre.appendChild(btn);
        pre.appendChild(code);
        box.appendChild(pre);

        last = regex.lastIndex;
    }

    // Remaining text after last code block
    const after = text.slice(last);
    if (after.trim()) {
        const p = document.createElement("div");
        p.innerHTML = escapeHTML(after).replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
        box.appendChild(p);
    }

    return box;
}

/* ---------- SEND MESSAGE ---------- */
async function sendMessage() {
    const input = document.getElementById("userInput");
    const msg = input.value.trim();
    if (!msg) return;

    const chat = document.getElementById("chatA");

    // Display user message
    const my = document.createElement("div");
    my.className = "myMsg";
    const myBox = document.createElement("div");
    myBox.className = "myBox";
    myBox.textContent = msg;
    my.appendChild(myBox);
    chat.appendChild(my);

    input.value = "";
    chat.scrollTop = chat.scrollHeight;

    // Loader animation
    const loader = document.createElement("div");
    loader.className = "aiMsg";
    loader.innerHTML = `<div class="aiBox typing"><span></span><span></span><span></span></div>
  <div id=container>
  
  <div id=flip>
    <div><div>Analysing</div></div>
    <div><div>Searching</div></div>
    <div><div>Thinking</div></div>
  </div>
  
</div>`;
    chat.appendChild(loader);
    chat.scrollTop = chat.scrollHeight;

    try {
        // Check Firebase if question exists
        const snapshot = await db.ref('mess').orderByChild('question').equalTo(msg).once('value');
        let reply = null;

        if (snapshot.exists()) {
            // If exists, get answer
            snapshot.forEach(child => {
                reply = child.val().answer;
            });
        } else {
            // Call API if question not in DB
            const res = await fetch("/chat", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({message: msg})
            });
            const data = await res.json();
            reply = data.reply || data.error;

            // Store question & answer in Firebase
            db.ref('qA').push({
                question: msg,
                answer: reply,
                timestamp: new Date().toISOString()
            });
        }

        loader.remove();

        // Display AI answer
        const ai = document.createElement("div");
        ai.className = "aiMsg";
        ai.appendChild(createAIMessageWithCopy(reply));
        chat.appendChild(ai);
        chat.scrollTop = chat.scrollHeight;

        // Store question locally for menu
        let history = JSON.parse(localStorage.getItem("chatHistory") || "[]");
        history.push({question: msg, answer: reply});
        localStorage.setItem("chatHistory", JSON.stringify(history));

    } catch(err) {
        loader.remove();
        const ai = document.createElement("div");
        ai.className = "aiMsg";
        ai.innerHTML = `<div class="aiBox">Error: ${escapeHTML(err.message)}</div>`;
        chat.appendChild(ai);
        chat.scrollTop = chat.scrollHeight;
    }
}
</script>

</body>
</html>
